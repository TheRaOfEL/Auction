{% extends 'main.html' %}

{% block content %}
    <!-- Header Section with New Design -->
    <div class="container-fluid bg-gradient-to-r from-darkblue-800 via-indigo-600 to-pink-600 py-5 text-white" style="padding-top: 120px;">
        <!-- Added padding-top to prevent overlap with fixed navbar -->
        <div class="row">
            <div class="col-12 col-lg-10">
                <h1 class="display-5 fw-bold ms-0 ps-0 ms-md-5 ps-md-5 pt-3">Your Watchlist</h1>
                <p class="fs-4 ms-0 ps-0 ms-md-5 ps-md-5">Stay updated with the items you're interested in!</p>
            </div>
        </div>
    </div>
    
    <div class="container py-5">
        {% if watchlist %}
            <div class="row">
                {% for auction in watchlist %}
                    <div class="col-md-4 mb-4">
                        <!-- Card for Auction -->
                        <div class="card shadow-lg rounded-lg overflow-hidden">
                            <img src="{{ auction.image.url }}" class="card-img-top" alt="{{ auction.name }}" style="object-fit: cover; height: 250px;">
                            <div class="card-body text-center">
                                <h5 class="card-title fw-bold">{{ auction.name }}</h5>
                                <p class="card-text text-muted">{{ auction.description|truncatechars:100 }}</p>
                                
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <p class="text-muted">Starting Bid: <span class="text-danger">${{ auction.starting_bid }}</span></p>
                                    <p class="text-muted" id="time-left-{{ auction.id }}"></p>
                                </div>
                                
                                <a href="{% url 'auction_detail' auction.id %}" class="btn btn-danger w-100 mt-3">View Auction</a>
                            </div>
                        </div>
                    </div>

                    <script>
                        // JavaScript to handle time left calculation
                        const endTime = new Date("{{ auction.end_at|date:'Y-m-d H:i:s' }}").getTime();
                        const timeLeftElement = document.getElementById("time-left-{{ auction.id }}");

                        function updateTimeLeft() {
                            const now = new Date().getTime();
                            const timeRemaining = endTime - now;

                            if (timeRemaining <= 0) {
                                timeLeftElement.innerHTML = "Auction Ended";
                            } else {
                                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));

                                timeLeftElement.innerHTML = `${days} days ${hours} hours ${minutes} minutes left`;
                            }
                        }

                        // Update every minute
                        setInterval(updateTimeLeft, 60000);
                        updateTimeLeft(); // Initial update
                    </script>

                {% endfor %}
            </div>
        {% else %}
            <p class="text-center fs-4">You have no auctions in your watchlist.</p>
        {% endif %}
    </div>
{% endblock %}
